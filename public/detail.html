<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Detail - LK21 Vibe</title>
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar scrolled" id="navbar">
        <div class="logo" onclick="location.href='/'">
            <svg width="80" height="80" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="48" fill="url(#goldGradient)" opacity="0.1"/>
                <g transform="translate(20, 25)">
                    <path d="M 5 10 L 55 2 L 55 12 L 5 20 Z" fill="url(#goldGradient)" stroke="#D4A017" stroke-width="1"/>
                    <rect x="10" y="4" width="8" height="14" fill="#0A1A2F" opacity="0.6" transform="skewY(-8)"/>
                    <rect x="25" y="2" width="8" height="14" fill="#0A1A2F" opacity="0.6" transform="skewY(-8)"/>
                    <rect x="40" y="0" width="8" height="14" fill="#0A1A2F" opacity="0.6" transform="skewY(-8)"/>
                    <rect x="5" y="20" width="50" height="35" rx="3" fill="#1a1a1a" stroke="url(#goldGradient)" stroke-width="2"/>
                    <g transform="translate(30, 37.5)">
                        <circle cx="0" cy="0" r="10" fill="url(#goldGradient)" opacity="0.2"/>
                        <path d="M -3 -5 L -3 5 L 5 0 Z" fill="#D4A017"/>
                    </g>
                </g>
                <defs>
                    <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#FFD700"/>
                        <stop offset="50%" stop-color="#D4A017"/>
                        <stop offset="100%" stop-color="#FFA500"/>
                    </linearGradient>
                </defs>
            </svg>
        </div>
        <button class="hamburger" id="hamburger" onclick="toggleMenu()">
            <span></span><span></span><span></span>
        </button>
        <div class="nav-links" id="navLinks">
            <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
            <a href="/films.html" class="nav-link"><i class="fas fa-film"></i> Film</a>
            <a href="/about.html" class="nav-link"><i class="fas fa-info-circle"></i> About</a>
            <a href="/contact.html" class="nav-link"><i class="fas fa-user"></i> Contact</a>
        </div>
        <div class="nav-overlay" id="navOverlay" onclick="closeMenu()"></div>
    </nav>

    <!-- Detail Container -->
    <div class="detail-container" id="detailContainer">
        <div class="detail-loading" id="loadingState">
            <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 LK21 Vibe. For educational purposes only.</p>
    </footer>

    <script>
        function toggleMenu() {
            document.getElementById('hamburger')?.classList.toggle('active');
            document.getElementById('navLinks')?.classList.toggle('active');
            document.getElementById('navOverlay')?.classList.toggle('active');
        }
        function closeMenu() {
            document.getElementById('hamburger')?.classList.remove('active');
            document.getElementById('navLinks')?.classList.remove('active');
            document.getElementById('navOverlay')?.classList.remove('active');
        }

        // Get movie URL from query params
        const urlParams = new URLSearchParams(window.location.search);
        const movieUrl = urlParams.get('url');

        if (!movieUrl) {
            document.getElementById('detailContainer').innerHTML = `
                <div class="detail-loading">
                    <p class="error">No movie specified</p>
                </div>
            `;
        } else {
            loadMovieDetail(movieUrl);
        }

        async function loadMovieDetail(url) {
            try {
                const response = await fetch(`/api/v1/detail?url=${encodeURIComponent(url)}`);
                const result = await response.json();

                if (result.status === 'success' && result.data) {
                    renderMovieDetail(result.data);
                } else {
                    showError('Failed to load movie details.');
                }
            } catch (err) {
                console.error('Error:', err);
                showError('Error loading movie details.');
            }
        }

        function renderMovieDetail(movie) {
            const poster = movie.poster || 'https://via.placeholder.com/300x450';
            const fullTitle = movie.title || 'Unknown Title';
            const synopsis = movie.synopsis || 'No synopsis available.';
            const rating = parseFloat(movie.rating) || 0;
            const director = movie.director || 'N/A';
            const cast = movie.cast || 'N/A';
            const country = movie.country || 'N/A';
            const duration = movie.duration || 'N/A';
            const watchLink = movie.downloadLink || movie.streamLink || '#';
            const trailerUrl = movie.trailerUrl || '';

            // Clean title
            let title = fullTitle.replace(/\s*\(\d{4}\)/, '').replace(/Sub\s+(Indo|Indonesia)/i, '').trim();
            const ratingPercent = (rating / 10) * 100;

            document.title = `${title} - LK21 Vibe`;

            document.getElementById('detailContainer').innerHTML = `
                <div class="detail-content">
                    <div class="detail-hero">
                        <div class="detail-hero-bg" style="background-image: url('${poster}')"></div>
                        <div class="detail-hero-overlay"></div>
                    </div>

                    <div class="detail-main">
                        <div class="detail-poster">
                            <img src="${poster}" alt="${title}">
                        </div>

                        <div class="detail-info">
                            <h1 class="detail-title">${title}</h1>

                            <div class="detail-rating-section">
                                <div class="rating-bar-container">
                                    <i class="fas fa-star rating-star-icon"></i>
                                    <div class="rating-bar-fill" style="width: ${ratingPercent}%">
                                        <span class="rating-text">${rating > 0 ? rating : 'N/A'}</span>
                                    </div>
                                </div>
                                <span class="rating-label">Rating</span>
                            </div>

                            <div class="detail-meta">
                                <span><i class="fas fa-clock"></i> ${duration}</span>
                                <span><i class="fas fa-globe"></i> ${country}</span>
                            </div>

                            <div class="detail-section">
                                <h3>Synopsis</h3>
                                <p class="synopsis-text">${synopsis}</p>
                            </div>

                            <div class="detail-section">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="label">Director:</span>
                                        <span class="value">${director}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Cast:</span>
                                        <span class="value">${cast}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                ${watchLink !== '#' ? `
                                    <a href="${watchLink}" target="_blank" rel="noopener noreferrer" class="watch-btn">
                                        <i class="fas fa-play"></i> WATCH MOVIE
                                    </a>
                                ` : `
                                    <button disabled class="watch-btn">Unavailable</button>
                                `}
                                ${trailerUrl ? `
                                    <a href="${trailerUrl}" target="_blank" rel="noopener noreferrer" class="trailer-btn">
                                        <i class="fas fa-video"></i> TRAILER
                                    </a>
                                ` : ''}
                                <button onclick="history.back()" class="back-btn">
                                    <i class="fas fa-arrow-left"></i> BACK
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('detailContainer').innerHTML = `
                <div class="detail-loading">
                    <p class="error">${message}</p>
                    <button onclick="history.back()" class="back-btn" style="margin-top: 1rem;">
                        <i class="fas fa-arrow-left"></i> BACK
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
